---
import "@astrojs/site-kit/tailwind.css"
import "@fontsource/inter/variable.css"
import "../styles/fonts.css"

import Inter from "@fontsource/inter/files/inter-latin-variable-wghtOnly-normal.woff2"
import Card, { type Props as CardProps } from "../components/Card.astro"
import Header from "../components/Header.astro"
import Hero from "../components/Hero.astro"
import Outlinks from "../components/Outlinks.astro"
import type { Example } from "../utils/index"
import { TOP_SECTION } from "../utils/index"

type Props = { examples: Array<[string, Example[]]> }
const { examples: groups } = Astro.props as Props

const pathname = Astro.url.pathname.replace(/\/$/, "")
---

<html lang="en" class="bg-astro-gray-700 text-astro-gray-100">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,intial-scale=1" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="alternate icon" type="image/x-icon" href="/favicon.ico" />
		<link
			rel="preload"
			href="/fonts/Obviously/Obviously Normal/Web/Obviously-Regular.woff2"
			as="font"
			type="font/woff2"
			crossorigin
		/>
		<link
			rel="preload"
			href="/fonts/MD IO/Web/MDIO0.5-Regular.woff2"
			as="font"
			type="font/woff2"
			crossorigin
		/>
		<link rel="preload" href={Inter} as="font" type="font/woff2" crossorigin />

		<title>astro.new{pathname}</title>
		<meta
			name="description"
			content="Quickly launch example Astro projects in your favorite browser IDE!"
		/>

		<!-- Fathom - beautiful, simple website analytics -->
		<script
			src="https://certain-quality.astro.build/script.js"
			data-site="EZBHTSIG"
			defer
		></script>
	</head>

	<body>
		<Header />
		<Hero />

		<main
			class="mx-auto flex max-w-screen-xl flex-col px-4 pt-8 sm:px-6 sm:pt-12 lg:px-8 lg:pt-16"
		>
			<ul class="templates mb-24 flex flex-col gap-24">
				{
					groups.map(([category, examples]) => {
						return (
							<li class="flex flex-col gap-8">
								<h2
									class:list={[
										"text-2xl",
										{ "sr-only": category === TOP_SECTION },
									]}
								>
									{category}
								</h2>
								<ul class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 lg:gap-6">
									{examples.map(
										(
											example: astroHTML.JSX.IntrinsicAttributes & CardProps,
										) => (
											<li>
												<Card {...example} />
											</li>
										),
									)}
									{category === TOP_SECTION && <Outlinks />}
								</ul>
							</li>
						)
					})
				}
			</ul>
		</main>
	</body>
</html>

<script>
	// find all internal links, this will pickup all redirects handled by the redirect function
	document
		.querySelectorAll<HTMLAnchorElement>("a[href^='/']")
		.forEach((link) => {
			link.addEventListener("click", () => {
				/** @ts-ignore */
				window.fathom.trackPageview({
					url: link.href,
				})
			})
		})
</script>
